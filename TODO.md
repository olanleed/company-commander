# Company Commander - TODO リスト

## 優先度: 高

### 対戦車ダメージモデルの改善
- [ ] LAW（軽対戦車火器）の貫徹力バランス調整
  - 現状: 重装甲戦車に対してほぼ無効
  - 検討: 側面/後方への攻撃時の貫徹率向上
- [ ] サブシステムダメージの可視化
  - mobility_hp/firepower_hp/sensors_hpの状態をHUDに表示
- [ ] Catastrophic Kill（爆発・炎上による即時破壊）の実装
  - 計画書: `docs/damage_model_v0.1.md` 参照
  - CRITICAL判定時に40%で即時破壊

### ユニット破壊演出
- [ ] Destroyed時のフェードアウト消滅
  - `is_destroyed`フラグは実装済み
  - ElementViewでのフェードアウト処理追加
- [ ] 爆発エフェクト（車両のcatastrophic kill時）

## 優先度: 中

### 戦闘システム
- [ ] 間接射撃（迫撃砲）の実装
  - MORTAR_SECユニットは定義済み
  - LoS不要の曲射弾道計算
- [ ] 煙幕（SMOKE）の実装
  - CW_MORTAR_SMOKEは武器定義済み
  - 視界遮断効果の追加
- [ ] 弾薬管理システム
  - 特にAT武器の弾数制限

### AI改善
- [ ] 抑圧状態での後退判断
  - BREAK_CONTACTテンプレートの自動発動
- [ ] 火力集中の最適化
  - 複数ユニットで同一目標を攻撃時の調整
- [ ] 遮蔽物利用の改善
  - 地形によるカバー効果の活用

### UI/UX
- [ ] ユニット状態アイコン（SUPPRESSED/PINNED/BROKEN）
- [ ] ミニマップへのユニット表示
- [ ] 戦闘ログパネル
- [ ] キーバインド設定

## 優先度: 低

### ゲームシステム
- [ ] 勝利条件の実装
  - 拠点制圧による勝利判定
  - 戦力比による勝利判定
- [ ] セーブ/ロード機能
- [ ] リプレイ機能

### マップ
- [ ] 追加マップの作成
- [ ] マップエディタ
- [ ] 高低差（elevation）の実装

### ユニット
- [ ] IFV（歩兵戦闘車）アーキタイプ追加
- [ ] 航空支援ユニット
- [ ] 工兵ユニットの特殊能力（地雷敷設等）

### ユニット組織階層（Platoon → Company）

現在は小隊（Platoon）が最小単位。将来的に中隊への拡張を計画。

#### 組織構造

| レベル | 規模 | 構成 | 備考 |
|--------|------|------|------|
| Platoon（小隊） | ~30人 | 3分隊 + 本部(PL, PSG, RTO) | 現在のINF_LINE |
| Company（中隊） | ~100人 | 3小隊 + 本部(CO, XO, 1SG) | 将来実装 |

#### 実装アプローチ案

1. **Option A: Elementに親子関係追加**
   - `parent_id: String`, `child_ids: Array[String]`をElementInstanceに追加
   - 利点: シンプル、既存構造を活用
   - 欠点: Element責務が増大

2. **Option B: UnitGroupクラス新設**
   - `UnitGroup { id, type, element_ids, formation, orders }`
   - 利点: 関心の分離、柔軟な階層構造
   - 欠点: 新しいエンティティ管理が必要

3. **Option C: CompanyControllerAI拡張**
   - AI側で複数Elementをグループ管理
   - 利点: 表示・戦闘ロジックは現状維持
   - 欠点: AIとデータモデルの結合度が高い

#### 検討事項

- [ ] 小隊/中隊レベルの命令体系（移動/攻撃/防御フォーメーション）
- [ ] 指揮官要素の損失による影響（士気、命令遅延）
- [ ] 小隊/中隊単位での視界・情報共有
- [ ] 編成エディタ（カスタム編成）

## 完了済み

### 2024-02 完了
- [x] 武器選択システムの実装
  - 目標タイプに応じた最適武器の自動選択
  - 歩兵 vs 戦車: LAW選択
  - 戦車 vs 歩兵: COAX_MG選択
- [x] ゾーン別装甲モデルの実装
  - 4ゾーン（FRONT/SIDE/REAR/TOP）
  - KE/CE貫徹判定
- [x] 衝突回避システム
  - ソフト/ハード衝突処理
- [x] HUD改善
  - AI思考情報表示
  - 現在使用武器の表示
- [x] Godot 4 型付き配列バグ修正
  - weaponsのインスタンス別初期化

---

## 参考資料
- 仕様書: `docs/` ディレクトリ
- 計画書: `~/.claude/plans/luminous-scribbling-dewdrop.md`（ダメージモデル見直し計画）
