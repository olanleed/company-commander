# 地形・通行仕様 v0.1
## Movement & Passability Spec

---

## 0) 目的

- ルート選択（道路・渡河点・森林縁）を「ゲームの意思決定」にする
- 兵科記号RTSでも"現代っぽい摩擦"が出るようにする
- ユニット個別の速度は後で良いので、まず**通行可否と相対的な遅速を固定する**

---

## 1) 地形は「レイヤー」で持つ

1セル（またはナビメッシュ領域）が持つ属性を3層に分ける。

### A. BaseTerrain（地表・土地被覆）

| 値 | 意味 |
|----|------|
| `OPEN` | 平地/草地/畑/荒地（基本） |
| `ROUGH` | 藪/岩場/瓦礫まじり地（走破性低） |
| `FOREST` | 森林（隠蔽・走破性低） |
| `URBAN` | 市街地（建物密集。歩兵は通れるが車両は道路依存） |
| `MARSH` | 湿地/軟弱地盤（車両は危険） |
| `WATER_SHALLOW` | 浅瀬/徒渉・渡渉可能域（限定） |
| `WATER_DEEP` | 深水（基本通行不可） |
| `CLIFF` | 崖/絶壁（通行不可） |

### B. RouteOverlay（道・通路の上書き）

| 値 | 意味 |
|----|------|
| `NONE` | なし |
| `TRAIL` | 小道・農道（狭い/未舗装） |
| `ROAD` | 一般道 |
| `HIGHWAY` | 幹線道路 |
| `BRIDGE` | 橋（WATER_DEEP上の通行点） |

### C. SlopeClass（勾配）

| 値 |
|----|
| `FLAT` |
| `GENTLE` |
| `STEEP` |
| `CLIFF` |

### 実装のコツ

- `URBAN` は「道路セル」を必ず敷く前提にすると、車両が市街ブロックを突っ切れない（現代戦っぽい）
- 森林や湿地も「`TRAIL`」がある場所だけ車両が抜けられる、が作れて戦術が生まれる

---

## 2) 機動種別（MobilityClass）を3つに固定

| 種別 | 対象 |
|------|------|
| `FOOT` | 歩兵・徒歩運用 |
| `WHEELED` | 装輪 |
| `TRACKED` | 装軌 |

> ユニットカテゴリ（INF/VEH/REC/…）ではなく、ユニットが持つ**機動種別**で判定する（WEAP/LOGでも同じ）。

---

## 3) 通行可否の「強制ルール」

### 3.1 URBAN は「車両＝道路依存」を強制

`URBAN` で `RouteOverlay = NONE` のセルは：

- `FOOT`：通行可
- `WHEELED` / `TRACKED`：**通行不可**（建物・狭隘・バリケード相当として扱う）

車両が URBAN に入るには `TRAIL` / `ROAD` / `HIGHWAY` が必要。

### 3.2 WHEELED は「森林オフロード不可」「湿地オフロード不可」

- `FOREST` で `RouteOverlay = NONE`：**WHEELED は通行不可**
- `MARSH` で `RouteOverlay = NONE`：**WHEELED は通行不可**
- `TRAIL` / `ROAD` がある森林・湿地は通行可（＝道に縛られる）

### 3.3 渡河を固定（現代戦っぽい要点）

| 地形 | FOOT | WHEELED | TRACKED |
|------|------|---------|---------|
| `WATER_DEEP` | 不可 | 不可 | 不可 |
| `WATER_SHALLOW`（渡渉点） | 可（遅い） | **不可** | 可（遅い） |
| `BRIDGE` | 可 | 可 | 可 |

> `BRIDGE` が破壊されたら全機動種別通行不可。
> `WHEELED` の渡渉禁止は v0.1 固定。後で例外追加可。

### 3.4 勾配の絶対制約

| SlopeClass | FOOT | WHEELED | TRACKED |
|------------|------|---------|---------|
| `CLIFF` | 不可 | 不可 | 不可 |
| `STEEP` | 可（非常に遅い） | **不可** | 可（非常に遅い） |

---

## 4) 速度（移動コスト）倍率テーブル

ユニット固有の `road_speed` / `cross_speed` に対して地形倍率を掛ける。

### 4.1 RouteOverlay 上の倍率（`road_speed` に掛ける）

| RouteOverlay | FOOT | WHEELED | TRACKED |
|-------------|------|---------|---------|
| `TRAIL` | 1.00 | 0.75 | 0.85 |
| `ROAD` | 1.05 | 1.00 | 1.00 |
| `HIGHWAY` | 1.05 | 1.10 | 1.05 |
| `BRIDGE` | 1.00 | 1.00 | 1.00 |

> 目標：車両は道路で速い／装輪は特に道路依存／装軌は万能だが万能すぎない

### 4.2 BaseTerrain 上の倍率（`cross_speed` に掛ける）

`RouteOverlay = NONE` のときに適用（URBAN の通行不可ルールに注意）。

| BaseTerrain | FOOT | WHEELED | TRACKED |
|-------------|------|---------|---------|
| `OPEN` | 1.00 | 0.80 | 0.75 |
| `ROUGH` | 0.80 | 0.55 | 0.60 |
| `FOREST` | 0.60 | **0.00（不可）** | 0.40 |
| `URBAN` | 0.70 | **0.00（不可）** | **0.00（不可）** |
| `MARSH` | 0.50 | **0.00（不可）** | 0.30 |
| `WATER_SHALLOW` | 0.40 | **0.00（不可）** | 0.50 |
| `WATER_DEEP` | 0.00 | 0.00 | 0.00 |
| `CLIFF` | 0.00 | 0.00 | 0.00 |

### 4.3 勾配倍率（最後に掛ける）

| SlopeClass | FOOT | WHEELED | TRACKED |
|------------|------|---------|---------|
| `FLAT` | 1.00 | 1.00 | 1.00 |
| `GENTLE` | 0.90 | 0.80 | 0.85 |
| `STEEP` | 0.70 | **0.00（不可）** | 0.50 |
| `CLIFF` | 0.00 | 0.00 | 0.00 |

---

## 5) 実際の移動速度の決め方（ルール）

```
if RouteOverlay != NONE AND 機動種別が通行可:
    速度 = road_speed × route_multiplier × slope_multiplier
else:
    速度 = cross_speed × terrain_multiplier × slope_multiplier

倍率 0.00 → 通行不可（パスファインディング対象外）
```

---

## 6) 追加ルール（v0.1任意・現代っぽさが跳ねる）

### 6.1 MARSH に「BoggingMeter」（スタック蓄積）

- `TRACKED` が `MARSH` を走ると **BoggingMeter** が増加
- 一定値を超えると **Immobilized**（動けない）
- `ENG` や `LOG` ユニットで Recover できる

> ランダム運ゲーにならず、"判断ミスの代償"としてリアルに効く。

### 6.2 TRAIL の混雑ペナルティ

- `TRAIL` は「車両はすれ違い困難」扱い → 混雑で速度低下
- `ROAD` / `HIGHWAY` は混雑に強い

> コンクエストで交差点・橋が本当に重要になる。

---

## 7) マップ制作の最低ルール

破綻しないために守るべきルール：

- **URBAN** には必ず `ROAD` / `TRAIL` のネットワークを敷く（車両の導線）
- **RIVER**（`WATER_DEEP`）には必ず `BRIDGE` か `WATER_SHALLOW`（渡渉点）を複数用意する
  - ただし渡渉点は `WHEELED` 不可にして"橋の価値"を残す
- **FOREST / MARSH** に `TRAIL` を通して、車両の抜け道/待ち伏せを作る

### 5拠点コンクエストの拠点設計指針

| 拠点性格 | 推奨条件 | 狙い |
|---------|---------|------|
| 交通結節点 | 橋・交差点 | 車両ルートの争奪 |
| 観測優位 | 森林縁・高地 | OBS ノードと組み合わせ |
| 歩兵優位 | 市街地 | URBAN の制圧ルールを活かす |

最低でもこの3性格を5拠点に含めると自然に噛み合う。
